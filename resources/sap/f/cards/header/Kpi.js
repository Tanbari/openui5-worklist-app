/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/library","sap/ui/model/json/JSONModel","sap/m/NumericContent","sap/m/ObjectNumber","sap/m/VBox","sap/m/Text","sap/m/Label","sap/f/cards/Data","sap/f/cards/header/KpiRenderer"],function(t,e,i,a,n,s,r,d,p){"use strict";var o=e.TextAlign;var l=t.extend("sap.f.cards.header.Kpi",{metadata:{properties:{data:{type:"object"},title:{type:"string"},subtitle:{type:"string"},unitOfMeasurement:{type:"string"},mainIndicator:{type:"object"},sideIndicators:{type:"array"},details:{type:"string"}},aggregations:{_title:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_subtitle:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_unitOfMeasurement:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_mainIndicator:{type:"sap.m.NumericContent",multiple:false,visibility:"hidden"},_sideIndicators:{type:"sap.m.VBox",multiple:true,visibility:"hidden"},_details:{type:"sap.m.Text",multiple:false,visibility:"hidden"}}}});l.prototype.init=function(){this.setModel(new i)};l.prototype._createContent=function(t){if(t.title){this.setAggregation("_title",new r({id:this.getId()+"-title",wrapping:true,maxLines:3,text:t.title}))}if(t.subtitle){this.setAggregation("_subtitle",new r({id:this.getId()+"-subtitle",wrapping:true,maxLines:2,text:t.subtitle}))}if(t.unitOfMeasurement){this.setAggregation("_unitOfMeasurement",new r({id:this.getId()+"-unitOfMeasurement",wrapping:false,text:t.unitOfMeasurement}))}if(t.mainIndicator){this.setAggregation("_mainIndicator",new a({id:this.getId()+"-mainIndicator",withMargin:false,animateTextChange:false,truncateValueTo:5,value:t.mainIndicator.number,scale:t.mainIndicator.unit,indicator:t.mainIndicator.trend,valueColor:t.mainIndicator.state}))}if(t.sideIndicators){t.sideIndicators.forEach(function(t,e){this.addAggregation("_sideIndicators",new s({id:this.getId()+"-sideIndicator"+e,items:[new r({id:this.getId()+"-sideIndicator"+e+"-title",wrapping:false,text:t.title}),new n({id:this.getId()+"-sideIndicator"+e+"-value",textAlign:o.End,emphasized:false,number:t.number,unit:t.unit})]}))}.bind(this))}if(t.details){this.setAggregation("_details",new r({id:this.getId()+"-details",wrapping:false,text:t.details}))}};l.prototype.applySettings=function(e,i){var a=e.data;if(a){this.setData(a);delete e.data}t.prototype.applySettings.apply(this,[e,i]);e.data=a;this._createContent(e);return this};l.prototype.setData=function(t){this.setProperty("data",t);if(!t){return this}var e=t.request;if(t.json&&!e){this._updateModel(t.json,t.path)}if(e){p.fetch(e).then(function(e){this._updateModel(e,t.path)}.bind(this)).catch(function(t){})}return this};l.prototype._updateModel=function(t,e){this.getModel().setData(t);this.bindElement({path:e||"/"})};return l});